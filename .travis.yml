language: python
python:
- '3.5'
addons:
  postgresql: '9.3'
env:
  global:
  - CF_USERNAME=1bda66bd-ed0a-4e6f-b0e2-069dd80af819
  - secure: eCutSua9mECi2uwiu5eHqRnvkJzjffyiDW1uXaMZ3Pitg2gzy3/RK2d6HE5kfLF/ckRrvlagiqhhDC5ZTDKgQKHe1zDMrMX4hz+mGuB5AqreXOMfffjahHi5WgxvMGEMu+Qiru8e7DdT88UZv2WeE/MqJ0R27LGVZDiIjN27M93fl9SgQP+e2ozP8uPOIVj03YR4gQYW5sf5DUd6yRRXcq0njmiJ2F63Jc+FQCSUFX9qcCnaRWoOrCzqSi/RGr/adBoeVD7VKBnGBzA3fHeD/ZQKhYfNzi0XfryCq3l0vbC6RADmlZvjWkGAoACZjlymJ7huJglyoFA0UKVZ+HYvI2CMJkziIss5wJFBmcDzJBJGzPTOMLnIYvlKPycxUHp+CUxMHzL3XrTWcSn7rckVZCvtG6/BO4LPG3tiDWzVg9smv1Y2Ad6mJ0gWbORS4Qv5pliW9LX9szRnMWvg/TaPeU/j9lZifMg/3/KiOBnrFXBzwSbB/fPCWWw+b77fqsbWGiCu2lsa1AP5BFHn8/XtKbb9lKdLuYNfQAODrp7KJA/haBk2UmF0nAMOtxWSujQV8kkwAouBk+CbcJ8ScltOwScEOlLOyn80CCskFuvboDRc7h6RE7BVl1K4QAAQ6W0r2xRsfZb9TUNXBZiyZtzuMrB5QSzTboYRwWwsBGfrkxA=
before_script:
- createdb forest-service-prototype
- cd forestserviceprototype && ./manage.py collectstatic --noinput -v 0
script:
- pytest --cov=forestserviceprototype --cov=specialuseform
- cd .. && bandit -r .
after_script:
- npm install -g pa11y-crawl
- pa11y-crawl --run "cd forestserviceprototype && ./manage.py runserver" --wait 10
  --ci http://localhost:8000
before_deploy:
- export PATH=$HOME:$PATH
- travis_retry curl -L -o $HOME/cf.tgz "https://cli.run.pivotal.io/stable?release=linux64-binary&version=6.15.0"
- tar xzvf $HOME/cf.tgz -C $HOME
- cf install-plugin autopilot -f -r CF-Community
deploy:
- provider: script
  script: "./bin/deploy staging"
  skip_cleanup: true
  on:
    branch: develop
