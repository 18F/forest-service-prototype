language: python
python:
- '3.5'
addons:
  postgresql: '9.3'
env:
  global:
  - CF_USERNAME=6c319632-cc9c-47c7-bda4-64d6abc4609d
  - secure: XKeo8I81vgZl9oF7IiEDlj8y+BkUmARp5/m2cD/LBHsSLiKRbNVg5jJMSfQCKKJOldo31pCJb+jGK/anEz6suZ8yL0M8D4fVsm3bKPP2ptvhOjLl695vT3lhU/NcbUC4rrVbGi3RFL4ig0WronwAAzkQqLrhb90jNV+4L4gKuRANhdxOTBT4+EqDMcBIafCpjw/Cs3BpWEDm3Xw++SQK5FsO9HHbcyWKmu2jLFdqA6on0m+u7nNi1CxIcj29ES6EHymoU08vTyiDs7fwAn2Au2IZvhi2cj0xMaJog7D7RCEmmywVewo0tEpD01Cf20U737WRExeaye8caQvI1wZftWqqASCnW2XPGMqRxMtpgaqh3lu4ZCyiEajbgU9mosRKequwBQrnbgAmPiuqKuwAHZFJxVRZNY8sFHHjiwBq+omzjgMYnI8i057/jL8tsnDlVN8+Chq+9vGGM87CU0KshBp1xKPGXjOR/h1bL65mvT85WgIz0V2L9ObYwQbaSqXETj0Q4IL1xM1mAaT8aGTtYlz4sEWn4PBEOsy6L5yc3vWf9a74V2ZcHWFN0Lr5Xu2moP+TFRvH+JtuKnE4SsLG2u2ferVEv1RV80/m+PRkqyPqqOypph/0X+Dd9N7v3+F2cnKdqSIfcFVt/Po3vnKjphKEJt7LRMQWDJ+voKKJLbY=
before_script:
- createdb forest-service-prototype
- cd forestserviceprototype && ./manage.py collectstatic --noinput -v 0
script:
- pytest --cov=forestserviceprototype --cov=specialuseform
- cd .. && bandit -r .
after_script:
- npm install -g pa11y-crawl
- pa11y-crawl --run "cd forestserviceprototype && ./manage.py runserver" --wait 10
  --ci http://localhost:8000
before_deploy:
- export PATH=$HOME:$PATH
- travis_retry curl -L -o $HOME/cf.tgz "https://cli.run.pivotal.io/stable?release=linux64-binary&version=6.15.0"
- tar xzvf $HOME/cf.tgz -C $HOME
- cf install-plugin autopilot -f -r CF-Community
deploy:
- provider: script
  script: "./bin/deploy staging"
  skip_cleanup: true
  on:
    branch: develop
